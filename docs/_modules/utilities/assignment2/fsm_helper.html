
<!DOCTYPE html>

<html lang="EN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>utilities.assignment2.fsm_helper &#8212; assignment2 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for utilities.assignment2.fsm_helper</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. module:: fsm_helper</span>
<span class="sd">	:platform: Unix</span>
<span class="sd">	:synopsis: Python module for the management of the battery status</span>
<span class="sd">   </span>
<span class="sd">.. moduleauthor:: Jabrail Chumakov &lt;jabrail.chumakov@nu.edu.kz&gt;</span>

<span class="sd">This is a ROS node for the second assignment of the Robotics Engineering Master program&#39;s Experimental Robotics course.</span>
<span class="sd">Its software architecture enables the initialization of a helper class for the Final State Machine that governs the</span>
<span class="sd">behavior of a surveillance robot. The node provides a way to keep the code in the state_machine.py node more organized</span>
<span class="sd">and easy to understand by defining each task in this node.</span>

<span class="sd">Publishes to:</span>
<span class="sd">	/cmd_vel control robot&#39;s velocities</span>
<span class="sd">	/robot/joint1_position_controller/command rotate arm&#39;s base joint</span>
<span class="sd">Subscribes to:</span>
<span class="sd">	/state/battery_low subscribes to battery state</span>
<span class="sd">	</span>
<span class="sd">Service:</span>
<span class="sd">	/state/recharge robot charging</span>
<span class="sd">	/armor_interface_srv for ontology communication</span>
<span class="sd">	/world_init obtain world information from aruco markers</span>
<span class="sd">	</span>
<span class="sd">Action Service:</span>
<span class="sd">	/move_base move robot between rooms</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">rospy</span>
<span class="kn">import</span> <span class="nn">rospkg</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">actionlib</span>
<span class="kn">import</span> <span class="nn">actionlib.msg</span>
<span class="kn">from</span> <span class="nn">move_base_msgs.msg</span> <span class="kn">import</span> <span class="n">MoveBaseAction</span><span class="p">,</span> <span class="n">MoveBaseGoal</span>
<span class="kn">from</span> <span class="nn">geometry_msgs.msg</span> <span class="kn">import</span> <span class="n">Twist</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Lock</span>
<span class="kn">from</span> <span class="nn">actionlib</span> <span class="kn">import</span> <span class="n">SimpleActionClient</span>

<span class="c1"># Import colorama to make colorful text printed on to console</span>
<span class="kn">from</span> <span class="nn">colorama</span> <span class="kn">import</span> <span class="n">Fore</span><span class="p">,</span> <span class="n">Back</span><span class="p">,</span> <span class="n">Style</span>

<span class="c1"># Import the message to rotate the camera during the surveillance phase</span>
<span class="kn">from</span> <span class="nn">sensor_msgs.msg</span> <span class="kn">import</span> <span class="n">JointState</span>

<span class="c1"># Import constant name defined to structure the architecture.</span>
<span class="kn">from</span> <span class="nn">assignment2</span> <span class="kn">import</span> <span class="n">architecture_name_mapper</span> <span class="k">as</span> <span class="n">anm</span>

<span class="c1"># Import the messages used by services and publishers.</span>
<span class="kn">from</span> <span class="nn">std_msgs.msg</span> <span class="kn">import</span> <span class="n">Bool</span><span class="p">,</span> <span class="n">Float64</span><span class="p">,</span> <span class="n">Float32</span>
<span class="kn">from</span> <span class="nn">std_srvs.srv</span> <span class="kn">import</span> <span class="n">SetBool</span><span class="p">,</span> <span class="n">SetBoolResponse</span><span class="p">,</span> <span class="n">SetBoolRequest</span>

<span class="c1"># Import services and messages to build the world</span>
<span class="kn">from</span> <span class="nn">assignment2.srv</span> <span class="kn">import</span> <span class="n">WorldInit</span><span class="p">,</span> <span class="n">WorldInitResponse</span>
<span class="kn">from</span> <span class="nn">assignment2.msg</span> <span class="kn">import</span> <span class="n">RoomConnection</span>

<span class="c1"># Armor import to work with the ontology</span>
<span class="kn">from</span> <span class="nn">armor_msgs.srv</span> <span class="kn">import</span> <span class="n">ArmorDirective</span><span class="p">,</span> <span class="n">ArmorDirectiveRequest</span><span class="p">,</span> <span class="n">ArmorDirectiveResponse</span>
<span class="kn">from</span> <span class="nn">armor_msgs.srv</span> <span class="kn">import</span> <span class="n">ArmorDirectiveList</span><span class="p">,</span> <span class="n">ArmorDirectiveListRequest</span><span class="p">,</span> <span class="n">ArmorDirectiveListResponse</span>

<span class="c1"># A tag for identifying logs producer.</span>
<span class="n">LOG_TAG</span> <span class="o">=</span> <span class="n">anm</span><span class="o">.</span><span class="n">NODE_STATE_MACHINE</span>

<span class="c1"># get the file path for rospy_tutorials</span>
<span class="n">rp</span> <span class="o">=</span> <span class="n">rospkg</span><span class="o">.</span><span class="n">RosPack</span><span class="p">()</span>
<span class="n">assignment_path</span> <span class="o">=</span> <span class="n">rp</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="s1">&#39;assignment2&#39;</span><span class="p">)</span>

<span class="c1"># Define the file path in which the ontology is stored</span>
<span class="n">ONTOLOGY_FILE_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">assignment_path</span><span class="p">,</span> <span class="s2">&quot;topological_map&quot;</span><span class="p">,</span> <span class="s2">&quot;topological_map.owl&quot;</span><span class="p">)</span>
<span class="n">ONTOLOGY_FILE_PATH_DEBUG</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">assignment_path</span><span class="p">,</span> <span class="s2">&quot;topological_map&quot;</span><span class="p">,</span> <span class="s2">&quot;new_topological_map.owl&quot;</span><span class="p">)</span>
<span class="n">WEB_PATH</span> <span class="o">=</span> <span class="s1">&#39;http://bnc/exp-rob-lab/2022-23&#39;</span>

<span class="c1"># Initialize and define the client to use armor</span>
<span class="n">cli_armorontology</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ServiceProxy</span><span class="p">(</span><span class="s1">&#39;/armor_interface_srv&#39;</span><span class="p">,</span> <span class="n">ArmorDirective</span><span class="p">)</span> 
<span class="c1"># Initialize and define the request message for armor</span>
<span class="n">armorontology_req</span> <span class="o">=</span> <span class="n">ArmorDirectiveRequest</span><span class="p">()</span>
<span class="c1"># Initialize and define the arg list to pass to the ontology</span>
<span class="n">ARGS</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># Define the number for which the state of the action client is done</span>
<span class="n">DONE</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># since the get_state() function returns 3 when the action server achieves the goal</span>



<div class="viewcode-block" id="ontology_manager"><a class="viewcode-back" href="../../../index.html#utilities.assignment2.fsm_helper.ontology_manager">[docs]</a><span class="k">def</span> <span class="nf">ontology_manager</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">primary_command_spec</span><span class="p">,</span> <span class="n">secondary_command_spec</span><span class="p">,</span> <span class="n">ARGS</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">	This function serves the purpose of communicating with the ARMOR service in order to obtain</span>
<span class="sd">	and update information about the environment in the ontology. It is used as a replacement for the ARMOR API.</span>
<span class="sd">		</span>
<span class="sd">	Args:</span>
<span class="sd">		command: command to execute (e.g. ADD, LOAD, ...).</span>
<span class="sd">		primary_command_spec: primary command specification (optional).</span>
<span class="sd">		secondary_command_spec: secondary command specification (optional).</span>
<span class="sd">		ARGS: the list of arguments (e.g. list of individuals to add).</span>
<span class="sd">	Returns:</span>
<span class="sd">		armorontology_res: returns a list of queried objects.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">armorontology_req</span><span class="o">.</span><span class="n">armor_request</span><span class="o">.</span><span class="n">client_name</span> <span class="o">=</span> <span class="s1">&#39;example&#39;</span>
	<span class="n">armorontology_req</span><span class="o">.</span><span class="n">armor_request</span><span class="o">.</span><span class="n">reference_name</span> <span class="o">=</span> <span class="s1">&#39;ontoRef&#39;</span>
	<span class="n">armorontology_req</span><span class="o">.</span><span class="n">armor_request</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="n">command</span>
	<span class="n">armorontology_req</span><span class="o">.</span><span class="n">armor_request</span><span class="o">.</span><span class="n">primary_command_spec</span> <span class="o">=</span> <span class="n">primary_command_spec</span>
	<span class="n">armorontology_req</span><span class="o">.</span><span class="n">armor_request</span><span class="o">.</span><span class="n">secondary_command_spec</span> <span class="o">=</span> <span class="n">secondary_command_spec</span>
	<span class="n">armorontology_req</span><span class="o">.</span><span class="n">armor_request</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">ARGS</span>
	<span class="n">rospy</span><span class="o">.</span><span class="n">wait_for_service</span><span class="p">(</span><span class="s1">&#39;/armor_interface_srv&#39;</span><span class="p">)</span>
	<span class="k">try</span><span class="p">:</span>
			<span class="n">armorontology_res</span> <span class="o">=</span> <span class="p">(</span><span class="n">cli_armorontology</span><span class="p">(</span><span class="n">armorontology_req</span><span class="p">))</span><span class="o">.</span><span class="n">armor_response</span><span class="o">.</span><span class="n">queried_objects</span>
			<span class="k">return</span> <span class="n">armorontology_res</span>
	<span class="k">except</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ServiceException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Service call failed: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>
			<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>
			
 	
<div class="viewcode-block" id="ontology_format"><a class="viewcode-back" href="../../../index.html#utilities.assignment2.fsm_helper.ontology_format">[docs]</a><span class="k">def</span> <span class="nf">ontology_format</span><span class="p">(</span><span class="n">old_list</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">	This function accepts a list as input and generates a new list that is based on the original one.</span>
<span class="sd">	The new list contains all elements of the original list starting from the specified &#39;start&#39; index</span>
<span class="sd">	and ending at the specified &#39;end&#39; index. The resulting list only includes characters and numbers</span>
<span class="sd">	within the range of the specified indexes.</span>
<span class="sd">		</span>
<span class="sd">	Args:</span>
<span class="sd">		old_list: refers to the list that requires formatting.</span>
<span class="sd">		start: refers to the index of the element in the original list that will be the first to be copied to the new list.</span>
<span class="sd">		end: refers to the index of the element in the original list that will be the last to be copied to the new list.</span>
<span class="sd">	Returns:</span>
<span class="sd">		new_list: refers to the list that has been properly formatted according to the specified requirements.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">new_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">num</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">old_list</span><span class="p">]</span>
	<span class="k">return</span> <span class="n">new_list</span></div>



<div class="viewcode-block" id="Helper"><a class="viewcode-back" href="../../../index.html#utilities.assignment2.fsm_helper.Helper">[docs]</a><span class="k">class</span> <span class="nc">Helper</span><span class="p">:</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	This class has been designed to separate the implementation of the Finite State Machine from the rest of the code in</span>
<span class="sd">	the state_machine.py node. By managing synchronization with subscribers, services, and action servers, it helps to</span>
<span class="sd">	ensure that the code is more readable and easier to understand.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">		This function is used to initiate the Helper class.</span>
<span class="sd">		</span>
<span class="sd">		Args:</span>
<span class="sd">			self: current class instance.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># Initialize the variables used in the class </span>
		<span class="bp">self</span><span class="o">.</span><span class="n">battery_low</span> <span class="o">=</span> <span class="kc">False</span>            <span class="c1"># Set to True if the battery of the robot is low</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">map_completed</span> <span class="o">=</span> <span class="kc">False</span>          <span class="c1"># Set to True when the ontology is complete</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">aruco_detected</span> <span class="o">=</span> <span class="kc">False</span>         <span class="c1"># Set to true when all the aruco markers have been detected</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">reasoner_done</span> <span class="o">=</span> <span class="kc">False</span>          <span class="c1"># Set to True after querying the ontology</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">motion_completed</span> <span class="o">=</span> <span class="kc">False</span>       <span class="c1"># Set to True when the robot arrives in the desired location</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">charge_reached</span> <span class="o">=</span> <span class="kc">False</span>         <span class="c1"># Set to True when the charging station is reached</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">check_completed</span> <span class="o">=</span> <span class="kc">False</span>        <span class="c1"># Set to True when the robot has finished surveillance action</span>
		
		<span class="bp">self</span><span class="o">.</span><span class="n">_rooms_coord</span> <span class="o">=</span> <span class="p">[]</span>                 <span class="c1"># List to store the coordinates X and Y of each room </span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_connections</span> <span class="o">=</span> <span class="p">[]</span>                 <span class="c1"># List of connections containing _connected_to and _through_door lists</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_connected_to</span> <span class="o">=</span> <span class="p">[]</span>                <span class="c1"># List of rooms connected to a specific room</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_through_door</span> <span class="o">=</span> <span class="p">[]</span>                <span class="c1"># List of doors used for connecting rooms</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_rooms</span> <span class="o">=</span> <span class="p">[]</span>                       <span class="c1"># List of all rooms </span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_doors</span> <span class="o">=</span> <span class="p">[]</span>                       <span class="c1"># List of all doors </span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_next_goal</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>                   <span class="c1"># Variable to store the name of the room that will be visited</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_prev_goal</span> <span class="o">=</span> <span class="n">anm</span><span class="o">.</span><span class="n">INIT_LOCATION</span>    <span class="c1"># Previous location, the robot starts from location &#39;E&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">markers_detected</span> <span class="o">=</span> <span class="mi">0</span>              <span class="c1"># Count the number of detected markers</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">charge_loc</span> <span class="o">=</span> <span class="n">anm</span><span class="o">.</span><span class="n">CHARGE_LOCATION</span>  <span class="c1"># Define the charging location</span>
		
		<span class="bp">self</span><span class="o">.</span><span class="n">rate</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Rate</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># Loop at 10hz</span>
		
		<span class="c1"># Initialize the current time</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">timer_now</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span>  
		<span class="c1"># Initialize and define the mutex to work with shared variables</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">mutex</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>
		
		<span class="c1"># Load the ontology</span>
		<span class="n">ARGS</span> <span class="o">=</span> <span class="p">[</span><span class="n">ONTOLOGY_FILE_PATH</span><span class="p">,</span> <span class="n">WEB_PATH</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;PELLET&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">]</span>
		<span class="n">ontology_manager</span><span class="p">(</span><span class="s1">&#39;LOAD&#39;</span><span class="p">,</span> <span class="s1">&#39;FILE&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ARGS</span><span class="p">)</span>	
		<span class="n">log_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Ontology successuly loaded&#39;</span>
		<span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">tag_log</span><span class="p">(</span><span class="n">log_msg</span><span class="p">,</span> <span class="n">LOG_TAG</span><span class="p">))</span>
		
		<span class="c1"># Subscribe to the topic that controls the battery level.</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">battery_sub</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Subscriber</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">TOPIC_BATTERY_LOW</span><span class="p">,</span> <span class="n">Bool</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">battery_callback</span><span class="p">)</span>
		
		<span class="c1"># Publisher to move rotate the camera for surveillance action</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pub_base_joint</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Publisher</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">TOPIC_JOINT_BASE</span><span class="p">,</span> <span class="n">Float64</span><span class="p">,</span> <span class="n">queue_size</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
		
		<span class="c1"># Publisher to make the robot explore the initial room</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">twist_pub</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Publisher</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">TOPIC_TWIST</span><span class="p">,</span> <span class="n">Twist</span><span class="p">,</span> <span class="n">queue_size</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
		
		<span class="c1"># Initialize and define the server to build the map</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">world_srv</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Service</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">TOPIC_WORLD</span><span class="p">,</span> <span class="n">WorldInit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_world_init</span><span class="p">)</span>
		
		<span class="c1"># Initialize and define the client for the recharge service</span>
		<span class="n">rospy</span><span class="o">.</span><span class="n">wait_for_service</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">TOPIC_RECHARGE</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">recharge_cli</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ServiceProxy</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">TOPIC_RECHARGE</span><span class="p">,</span> <span class="n">SetBool</span><span class="p">)</span>
		
		<span class="c1"># Initialize and define the action client for the move base action service</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">move_cli</span> <span class="o">=</span> <span class="n">actionlib</span><span class="o">.</span><span class="n">SimpleActionClient</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">ACTION_MOTION</span><span class="p">,</span> <span class="n">MoveBaseAction</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">move_cli</span><span class="o">.</span><span class="n">wait_for_server</span><span class="p">()</span>
			
		
		
<div class="viewcode-block" id="Helper.handle_world_init"><a class="viewcode-back" href="../../../index.html#utilities.assignment2.fsm_helper.Helper.handle_world_init">[docs]</a>	<span class="k">def</span> <span class="nf">handle_world_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">		This service retrieves information about the map from aruco markers detected by the system.</span>
<span class="sd">		The collected information is then used to construct an ontology of the environment, enabling</span>
<span class="sd">		the robot to navigate and behave appropriately within the indoor setting.</span>
<span class="sd">		</span>
<span class="sd">		Args:</span>
<span class="sd">			self: current class instance.</span>
<span class="sd">			request: string and floating-point values are used to indicate the name of the room, its</span>
<span class="sd">			spatial coordinates, and its connections to other rooms through the doors that connect them.</span>
<span class="sd">		</span>
<span class="sd">		Returns:</span>
<span class="sd">			response: a boolean value is used to indicate whether the information has been successfully retrieved or not.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_rooms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">room</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_rooms_coord</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">request</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">y</span><span class="p">])</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">connections</span><span class="p">)):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_connected_to</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">connections</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">connected_to</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_through_door</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">connections</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">through_door</span>
			<span class="n">new_element</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_connected_to</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_through_door</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">new_element</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connections</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_connections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_element</span><span class="p">)</span>
			<span class="n">ARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hasDoor&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connections</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connections</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
			<span class="n">ontology_manager</span><span class="p">(</span><span class="s1">&#39;ADD&#39;</span><span class="p">,</span> <span class="s1">&#39;OBJECTPROP&#39;</span><span class="p">,</span> <span class="s1">&#39;IND&#39;</span><span class="p">,</span> <span class="n">ARGS</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">markers_detected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markers_detected</span> <span class="o">+</span> <span class="mi">1</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">markers_detected</span> <span class="o">==</span> <span class="n">anm</span><span class="o">.</span><span class="n">MARKERS_NUMBER</span><span class="p">:</span>
			<span class="c1"># Debug</span>
			<span class="n">log_msg</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">ROOM:</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_rooms</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
				   <span class="sa">f</span><span class="s1">&#39;COORDINATES:</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_rooms_coord</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
			           <span class="sa">f</span><span class="s1">&#39;CONNECTIONS:</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_connections</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
			<span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">tag_log</span><span class="p">(</span><span class="n">log_msg</span><span class="p">,</span> <span class="n">LOG_TAG</span><span class="p">))</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">aruco_detected</span> <span class="o">=</span> <span class="kc">True</span>     
		<span class="k">return</span> <span class="n">WorldInitResponse</span><span class="p">(</span><span class="n">status</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span></div>
	
		
<div class="viewcode-block" id="Helper.aruco_done"><a class="viewcode-back" href="../../../index.html#utilities.assignment2.fsm_helper.Helper.aruco_done">[docs]</a>	<span class="k">def</span> <span class="nf">aruco_done</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">		Retrieve the value of the variable that indicates whether all the markers have been detected, and whether</span>
<span class="sd">		the information gathered from them can be used to update the ontology. The function will return &quot;True&quot; if</span>
<span class="sd">		all the arucos have been detected, and &quot;False&quot; otherwise.</span>
<span class="sd">		</span>
<span class="sd">		Args:</span>
<span class="sd">			self: current class instance.</span>
<span class="sd">		</span>
<span class="sd">		Returns:</span>
<span class="sd">			self.aruco_detected: a boolean value that indicates the current status of aruco detection.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">aruco_detected</span></div>
			
		
<div class="viewcode-block" id="Helper.build_environment"><a class="viewcode-back" href="../../../index.html#utilities.assignment2.fsm_helper.Helper.build_environment">[docs]</a>	<span class="k">def</span> <span class="nf">build_environment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">		This method initializes the environment ontology by using the ARMOR service. Once all the markers have been detected,</span>
<span class="sd">		this method is called to upload all the new information about each room to the ontology. By utilizing the ARMOR service,</span>
<span class="sd">		it is possible to initialize and define all the necessary components to ensure the correct operation of the program.</span>
<span class="sd">		</span>
<span class="sd">		Args:</span>
<span class="sd">			self: current class instance.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># Get the number of rooms</span>
		<span class="n">rooms_number</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rooms</span><span class="p">))</span>
		<span class="c1"># Get the number of connections</span>
		<span class="n">connections_number</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_connections</span><span class="p">))</span>
		<span class="c1"># Link doors and rooms according to the connections informations</span>
		<span class="k">for</span> <span class="n">con</span> <span class="ow">in</span> <span class="n">connections_number</span><span class="p">:</span>
			<span class="n">ARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hasDoor&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connections</span><span class="p">[</span><span class="n">con</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connections</span><span class="p">[</span><span class="n">con</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
			<span class="n">ontology_manager</span><span class="p">(</span><span class="s1">&#39;ADD&#39;</span><span class="p">,</span> <span class="s1">&#39;OBJECTPROP&#39;</span><span class="p">,</span> <span class="s1">&#39;IND&#39;</span><span class="p">,</span> <span class="n">ARGS</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_doors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_connections</span><span class="p">[</span><span class="n">con</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
		<span class="c1"># Disjoint rooms, doors and robot</span>
		<span class="n">ARGS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rooms</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_doors</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;Robot1&#39;</span><span class="p">]</span>
		<span class="n">ontology_manager</span><span class="p">(</span><span class="s1">&#39;DISJOINT&#39;</span><span class="p">,</span> <span class="s1">&#39;IND&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ARGS</span><span class="p">)</span>
		<span class="c1"># State the robot initial position</span>
		<span class="n">ARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;isIn&#39;</span><span class="p">,</span> <span class="s1">&#39;Robot1&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_loc</span><span class="p">]</span>
		<span class="n">ontology_manager</span><span class="p">(</span><span class="s1">&#39;ADD&#39;</span><span class="p">,</span> <span class="s1">&#39;OBJECTPROP&#39;</span><span class="p">,</span> <span class="s1">&#39;IND&#39;</span> <span class="p">,</span> <span class="n">ARGS</span><span class="p">)</span>
		<span class="c1"># Get a time in the past (before the timestamp of the robot)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">timer_now</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">1000000000</span><span class="p">))</span> <span class="c1"># Make every room URGENT at the beginning  </span>
		<span class="c1"># Start the timestamp in every location to retrieve when a location becomes urgent</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rooms_number</span><span class="p">:</span>
			<span class="n">ARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;visitedAt&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rooms</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;Long&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer_now</span><span class="p">]</span>
			<span class="n">ontology_manager</span><span class="p">(</span><span class="s1">&#39;ADD&#39;</span><span class="p">,</span> <span class="s1">&#39;DATAPROP&#39;</span><span class="p">,</span> <span class="s1">&#39;IND&#39;</span><span class="p">,</span> <span class="n">ARGS</span><span class="p">)</span>
			<span class="c1"># Reason about the ontology to assign the timestamp</span>
			<span class="n">ARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
			<span class="n">ontology_manager</span><span class="p">(</span><span class="s1">&#39;REASON&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ARGS</span><span class="p">)</span>
			<span class="n">ARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;visitedAt&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rooms</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
			<span class="n">last_location</span> <span class="o">=</span> <span class="n">ontology_manager</span><span class="p">(</span><span class="s1">&#39;QUERY&#39;</span><span class="p">,</span> <span class="s1">&#39;DATAPROP&#39;</span><span class="p">,</span> <span class="s1">&#39;IND&#39;</span><span class="p">,</span> <span class="n">ARGS</span><span class="p">)</span>
			<span class="n">last_location</span> <span class="o">=</span> <span class="n">ontology_format</span><span class="p">(</span><span class="n">last_location</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span> 
		<span class="c1"># Update the timestamp of corridor &#39;E&#39; since the robot spawns in it</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">timer_now</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span> <span class="c1"># initial location is not urgent</span>
		<span class="n">ARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;visitedAt&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_loc</span><span class="p">,</span> <span class="s1">&#39;Long&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer_now</span><span class="p">,</span> <span class="n">last_location</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
		<span class="n">ontology_manager</span><span class="p">(</span><span class="s1">&#39;REPLACE&#39;</span><span class="p">,</span> <span class="s1">&#39;DATAPROP&#39;</span><span class="p">,</span> <span class="s1">&#39;IND&#39;</span><span class="p">,</span> <span class="n">ARGS</span><span class="p">)</span>
		<span class="c1"># Save ontology for DEBUG purposes</span>
		<span class="c1">#ARGS = [ONTOLOGY_FILE_PATH_DEBUG] # &lt;--- uncomment this line for ontology debug</span>
		<span class="c1">#ontology_manager(&#39;SAVE&#39;, &#39;&#39;, &#39;&#39;, ARGS) # &lt;--- uncomment this line for ontology debug</span>
		<span class="n">log_msg</span> <span class="o">=</span> <span class="n">Fore</span><span class="o">.</span><span class="n">GREEN</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Map has been constructed</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">tag_log</span><span class="p">(</span><span class="n">log_msg</span><span class="p">,</span> <span class="n">LOG_TAG</span><span class="p">))</span>
		<span class="c1"># Reset console color to default</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[39m&#39;</span><span class="p">)</span> 
		<span class="c1"># Before continuing make the robot rotate on itself to understand the sorroundings</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">explore_init_room</span><span class="p">()</span> 
		<span class="bp">self</span><span class="o">.</span><span class="n">map_completed</span> <span class="o">=</span> <span class="kc">True</span>   <span class="c1"># Set to True only the one involved in the state</span></div>
		
		
<div class="viewcode-block" id="Helper.explore_init_room"><a class="viewcode-back" href="../../../index.html#utilities.assignment2.fsm_helper.Helper.explore_init_room">[docs]</a>	<span class="k">def</span> <span class="nf">explore_init_room</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>	
<span class="w">		</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">		This method enables the robot to rotate in place once the ontology has been completely uploaded.</span>
<span class="sd">		This rotation takes place within the initial room before the robot starts processing and reasoning</span>
<span class="sd">		about the environment. The purpose of this rotation is to help the robot gain a better understanding</span>
<span class="sd">		of its surroundings and to allow time for the map to be uploaded in Rviz, thus preventing collisions</span>
<span class="sd">		with walls or other obstacles.</span>
<span class="sd">		</span>
<span class="sd">		Args:</span>
<span class="sd">			self: current class instance.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">cmd</span> <span class="o">=</span> <span class="n">Twist</span><span class="p">()</span>
		<span class="c1"># No linear motion</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="c1"># Rotate on itself</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.6</span>
		<span class="c1"># start the timer</span>
		<span class="n">start_time</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
		<span class="n">log_msg</span> <span class="o">=</span> <span class="n">Fore</span><span class="o">.</span><span class="n">GREEN</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Move around to investigate from different angles!</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">tag_log</span><span class="p">(</span><span class="n">log_msg</span><span class="p">,</span> <span class="n">LOG_TAG</span><span class="p">))</span>
		<span class="c1"># Reset console color to default</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[39m&#39;</span><span class="p">)</span> 
		<span class="c1"># Run the loop for six seconds to allow the ROBOT to undertand its sorroundings</span>
		<span class="k">while</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">twist_pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>
		<span class="c1"># Stop rotation</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">twist_pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span></div>
		
		
<div class="viewcode-block" id="Helper.world_done"><a class="viewcode-back" href="../../../index.html#utilities.assignment2.fsm_helper.Helper.world_done">[docs]</a>	<span class="k">def</span> <span class="nf">world_done</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">		Retrieve the value of the variable that indicates whether the environment has been created</span>
<span class="sd">		using the ARMOR service to define the ontology. The function will return &quot;True&quot; if the map</span>
<span class="sd">		has been successfully created, and &quot;False&quot; otherwise.</span>
<span class="sd">		</span>
<span class="sd">		Args:</span>
<span class="sd">			self: current class instance.</span>
<span class="sd">		</span>
<span class="sd">		Returns:</span>
<span class="sd">			self.map_completed: a boolean value that indicates the current status of the map generation.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_completed</span></div>
		
			
<div class="viewcode-block" id="Helper.reason"><a class="viewcode-back" href="../../../index.html#utilities.assignment2.fsm_helper.Helper.reason">[docs]</a>	<span class="k">def</span> <span class="nf">reason</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">		This method communicates with the pre-existing ontology to gather information and determine the</span>
<span class="sd">		robot&#39;s next move based on the desired surveillance behavior. Firstly, reachable rooms and their</span>
<span class="sd">		status (e.g., ROOM, URGENT, CORRIDOR) are retrieved. Then, each reachable room is checked, and</span>
<span class="sd">		the robot will move first to URGENT locations. If no URGENT locations are present, it will stay on CORRIDORS.</span>
<span class="sd">		If there are no CORRIDORS, the robot will move to a random ROOM. Finally, the method returns the next</span>
<span class="sd">		location that the robot will visit.</span>
<span class="sd">		</span>
<span class="sd">		Args:</span>
<span class="sd">			self: current class instance.</span>
<span class="sd">			</span>
<span class="sd">		Returns:</span>
<span class="sd">			self._next_goal: refers to the next location that the reasoner has determined the robot should reach.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># Reset the boolean variables</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">reset_var</span><span class="p">()</span>
		<span class="c1"># Reason about the onoloy</span>
		<span class="n">ARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
		<span class="n">ontology_manager</span><span class="p">(</span><span class="s1">&#39;REASON&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ARGS</span><span class="p">)</span>
		<span class="c1"># Retreive the locations that the robot can reach</span>
		<span class="n">ARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;canReach&#39;</span><span class="p">,</span> <span class="s1">&#39;Robot1&#39;</span><span class="p">]</span>
		<span class="n">can_reach</span> <span class="o">=</span> <span class="n">ontology_manager</span><span class="p">(</span><span class="s1">&#39;QUERY&#39;</span><span class="p">,</span> <span class="s1">&#39;OBJECTPROP&#39;</span><span class="p">,</span> <span class="s1">&#39;IND&#39;</span><span class="p">,</span> <span class="n">ARGS</span><span class="p">)</span>
		<span class="n">can_reach</span> <span class="o">=</span> <span class="n">ontology_format</span><span class="p">(</span><span class="n">can_reach</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
		<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">can_reach</span><span class="p">)</span> <span class="c1"># Make the choice randomic</span>
		<span class="n">log_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">REACHABLE LOCATIONS: </span><span class="si">{</span><span class="n">can_reach</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">tag_log</span><span class="p">(</span><span class="n">log_msg</span><span class="p">,</span> <span class="n">LOG_TAG</span><span class="p">))</span>
		<span class="c1"># Retrieve the status of the reachable locations</span>
		<span class="n">loc_status</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">all_status</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">can_reach</span><span class="p">)):</span>
			<span class="n">ARGS</span> <span class="o">=</span> <span class="p">[</span><span class="n">can_reach</span><span class="p">[</span><span class="n">loc</span><span class="p">],</span> <span class="s1">&#39;false&#39;</span><span class="p">]</span>
			<span class="n">loc_status</span> <span class="o">=</span> <span class="n">ontology_manager</span><span class="p">(</span><span class="s1">&#39;QUERY&#39;</span><span class="p">,</span> <span class="s1">&#39;CLASS&#39;</span><span class="p">,</span> <span class="s1">&#39;IND&#39;</span><span class="p">,</span> <span class="n">ARGS</span><span class="p">)</span>  
			<span class="n">loc_status</span> <span class="o">=</span> <span class="n">ontology_format</span><span class="p">(</span><span class="n">loc_status</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
			<span class="n">log_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">ROOM: </span><span class="si">{</span><span class="n">can_reach</span><span class="p">[</span><span class="n">loc</span><span class="p">]</span><span class="si">}</span><span class="s1"> -&gt; STATUS: </span><span class="si">{</span><span class="n">loc_status</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">tag_log</span><span class="p">(</span><span class="n">log_msg</span><span class="p">,</span> <span class="n">LOG_TAG</span><span class="p">))</span>
			<span class="n">all_status</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loc_status</span><span class="p">)</span>
		<span class="c1"># Check the status of the room (i.e. ROOM, CORRIDOR, URGENT)</span>
		<span class="n">urgent_loc</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">possible_corridor</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">sta</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_status</span><span class="p">)):</span>
			<span class="k">for</span> <span class="n">urg</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_status</span><span class="p">[</span><span class="n">sta</span><span class="p">])):</span>
				<span class="c1"># If location is urgent and it is reachable</span>
				<span class="k">if</span> <span class="n">all_status</span><span class="p">[</span><span class="n">sta</span><span class="p">][</span><span class="n">urg</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;URGENT&#39;</span><span class="p">:</span>
					<span class="n">urgent_loc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">can_reach</span><span class="p">[</span><span class="n">sta</span><span class="p">])</span>
				<span class="c1"># If location is a corridor and it is reachable</span>
				<span class="k">elif</span> <span class="n">all_status</span><span class="p">[</span><span class="n">sta</span><span class="p">][</span><span class="n">urg</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;CORRIDOR&#39;</span><span class="p">:</span>
					<span class="n">possible_corridor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">can_reach</span><span class="p">[</span><span class="n">sta</span><span class="p">])</span>
		<span class="c1"># Retrieve the next location taht will be checked by the robot</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">urgent_loc</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">log_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">NO URGENT LOCATIONS</span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">tag_log</span><span class="p">(</span><span class="n">log_msg</span><span class="p">,</span> <span class="n">LOG_TAG</span><span class="p">))</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">possible_corridor</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">log_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">NO REACHABLE CORRIDORS</span><span class="se">\n</span><span class="s1">CHOOSE A RANDOMIC REACHABLE ROOM</span><span class="se">\n</span><span class="s1">&#39;</span>
				<span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">tag_log</span><span class="p">(</span><span class="n">log_msg</span><span class="p">,</span> <span class="n">LOG_TAG</span><span class="p">))</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_next_goal</span> <span class="o">=</span> <span class="n">can_reach</span> <span class="c1"># take the reachable rooms</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">log_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">CORRIDORS: </span><span class="si">{</span><span class="n">possible_corridor</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
				<span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">tag_log</span><span class="p">(</span><span class="n">log_msg</span><span class="p">,</span> <span class="n">LOG_TAG</span><span class="p">))</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">_next_goal</span> <span class="o">=</span> <span class="n">possible_corridor</span> <span class="c1"># take the reachable corridors</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">log_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">URGENT: </span><span class="si">{</span><span class="n">urgent_loc</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">tag_log</span><span class="p">(</span><span class="n">log_msg</span><span class="p">,</span> <span class="n">LOG_TAG</span><span class="p">))</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_next_goal</span> <span class="o">=</span> <span class="n">urgent_loc</span> <span class="c1"># take the urgent rooms</span>
		<span class="c1"># If the next goal is a list, take only the first one</span>
		<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_next_goal</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_next_goal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_goal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">reasoner_done</span> <span class="o">=</span> <span class="kc">True</span>   <span class="c1"># Set to True only the one involved in the state</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_goal</span></div>
		
		
<div class="viewcode-block" id="Helper.reason_done"><a class="viewcode-back" href="../../../index.html#utilities.assignment2.fsm_helper.Helper.reason_done">[docs]</a>	<span class="k">def</span> <span class="nf">reason_done</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">		This function retrieves the value of the variable that indicates whether the reasoning phase,</span>
<span class="sd">		which involves retrieving information from the ontology using the ARMOR service, has been completed.</span>
<span class="sd">		The function will return a boolean value of &quot;True&quot; if the reasoning phase is complete, and &quot;False&quot; otherwise.</span>
<span class="sd">		</span>
<span class="sd">		Args:</span>
<span class="sd">			self: current class instance.</span>
<span class="sd">		</span>
<span class="sd">		Returns:</span>
<span class="sd">			self.reasoner_done: a boolean value that indicates the current status of the reasoner.</span>
<span class="sd">		</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reasoner_done</span></div>
	
	
<div class="viewcode-block" id="Helper.go_to_charge"><a class="viewcode-back" href="../../../index.html#utilities.assignment2.fsm_helper.Helper.go_to_charge">[docs]</a>	<span class="k">def</span> <span class="nf">go_to_charge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">		This function enables the robot to navigate towards the charging station when its battery level is low.</span>
<span class="sd">		It sets the charging station as the robot&#39;s target location and calls the self.go_to_goal method to reach it.</span>
<span class="sd">		The variable charge_reached is set to True once the robot successfully reaches room &#39;E&#39;, indicating that it</span>
<span class="sd">		is ready to be charged.</span>
<span class="sd">		</span>
<span class="sd">		Args:</span>
<span class="sd">			self: current class instance.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># Reset the boolean variables</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">reset_var</span><span class="p">()</span>
		<span class="c1"># Set the next location to be the charging station</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_next_goal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_loc</span>
		<span class="n">log_msg</span> <span class="o">=</span> <span class="n">Fore</span><span class="o">.</span><span class="n">RED</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Battery is low! Moving to charging station!&#39;</span>
		<span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">tag_log</span><span class="p">(</span><span class="n">log_msg</span><span class="p">,</span> <span class="n">LOG_TAG</span><span class="p">))</span>
		<span class="c1"># Reset console color to default</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[39m&#39;</span><span class="p">)</span> 
		<span class="bp">self</span><span class="o">.</span><span class="n">go_to_goal</span><span class="p">()</span>
		<span class="c1"># Loops until the plan action service is Not DONE</span>
		<span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_cli</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span> <span class="o">!=</span> <span class="n">DONE</span><span class="p">:</span> 
			<span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span> <span class="c1"># Wate time</span>
		<span class="c1"># Update the position of the ROBOT in the ontology</span>
		<span class="n">ARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;isIn&#39;</span><span class="p">,</span> <span class="s1">&#39;Robot1&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_goal</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prev_goal</span><span class="p">]</span>
		<span class="n">ontology_manager</span><span class="p">(</span><span class="s1">&#39;REPLACE&#39;</span><span class="p">,</span> <span class="s1">&#39;OBJECTPROP&#39;</span><span class="p">,</span> <span class="s1">&#39;IND&#39;</span> <span class="p">,</span> <span class="n">ARGS</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_prev_goal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_goal</span>
		<span class="c1"># Reason about the onoloy</span>
		<span class="n">ARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
		<span class="n">ontology_manager</span><span class="p">(</span><span class="s1">&#39;REASON&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ARGS</span><span class="p">)</span>
		<span class="c1"># Retreive the last time the robot moved</span>
		<span class="n">ARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;now&#39;</span><span class="p">,</span> <span class="s1">&#39;Robot1&#39;</span><span class="p">]</span>
		<span class="n">last_motion</span> <span class="o">=</span> <span class="n">ontology_manager</span><span class="p">(</span><span class="s1">&#39;QUERY&#39;</span><span class="p">,</span> <span class="s1">&#39;DATAPROP&#39;</span><span class="p">,</span> <span class="s1">&#39;IND&#39;</span><span class="p">,</span> <span class="n">ARGS</span><span class="p">)</span>
		<span class="n">last_motion</span> <span class="o">=</span> <span class="n">ontology_format</span><span class="p">(</span><span class="n">last_motion</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
		<span class="c1"># Retreive the last time a specific location has been visited</span>
		<span class="n">ARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;visitedAt&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_goal</span><span class="p">]</span>
		<span class="n">last_location</span> <span class="o">=</span> <span class="n">ontology_manager</span><span class="p">(</span><span class="s1">&#39;QUERY&#39;</span><span class="p">,</span> <span class="s1">&#39;DATAPROP&#39;</span><span class="p">,</span> <span class="s1">&#39;IND&#39;</span><span class="p">,</span> <span class="n">ARGS</span><span class="p">)</span>
		<span class="n">last_location</span> <span class="o">=</span> <span class="n">ontology_format</span><span class="p">(</span><span class="n">last_location</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span> 
		<span class="c1"># Update the time</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">timer_now</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span> 
		<span class="c1"># Update the timestamp since the robot moved</span>
		<span class="n">ARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;now&#39;</span><span class="p">,</span> <span class="s1">&#39;Robot1&#39;</span><span class="p">,</span> <span class="s1">&#39;Long&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer_now</span><span class="p">,</span> <span class="n">last_motion</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
		<span class="n">ontology_manager</span><span class="p">(</span><span class="s1">&#39;REPLACE&#39;</span><span class="p">,</span> <span class="s1">&#39;DATAPROP&#39;</span><span class="p">,</span> <span class="s1">&#39;IND&#39;</span><span class="p">,</span> <span class="n">ARGS</span><span class="p">)</span>
		<span class="c1"># Update the timestamp since the robot visited the location</span>
		<span class="n">ARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;visitedAt&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_goal</span><span class="p">,</span> <span class="s1">&#39;Long&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer_now</span><span class="p">,</span> <span class="n">last_location</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
		<span class="n">ontology_manager</span><span class="p">(</span><span class="s1">&#39;REPLACE&#39;</span><span class="p">,</span> <span class="s1">&#39;DATAPROP&#39;</span><span class="p">,</span> <span class="s1">&#39;IND&#39;</span><span class="p">,</span> <span class="n">ARGS</span><span class="p">)</span>
		<span class="n">log_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">The ROBOT arrived at the CHARGING STATION&#39;</span>
		<span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">tag_log</span><span class="p">(</span><span class="n">log_msg</span><span class="p">,</span> <span class="n">LOG_TAG</span><span class="p">))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">charge_reached</span> <span class="o">=</span> <span class="kc">True</span>   <span class="c1"># Set to True only the one involved in the state</span></div>
		
<div class="viewcode-block" id="Helper.charge_ready"><a class="viewcode-back" href="../../../index.html#utilities.assignment2.fsm_helper.Helper.charge_ready">[docs]</a>	<span class="k">def</span> <span class="nf">charge_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">		Retrieve the value of the variable indicating if the robot has reached the charging location</span>
<span class="sd">		and is ready to be charged. The returned value will be &quot;True&quot; if the charging location is reached,</span>
<span class="sd">		and &quot;False&quot; otherwise.</span>
<span class="sd">		</span>
<span class="sd">		Args:</span>
<span class="sd">			self: current class instance.</span>
<span class="sd">		</span>
<span class="sd">		Returns:</span>
<span class="sd">			self.charge_reached: a boolean variable that indicates whether the robot has reached the charging location.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_reached</span></div>
		
	
<div class="viewcode-block" id="Helper.battery_callback"><a class="viewcode-back" href="../../../index.html#utilities.assignment2.fsm_helper.Helper.battery_callback">[docs]</a>	<span class="k">def</span> <span class="nf">battery_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">		This function is responsible for handling the subscription to the topic /state/battery_low in order to get updates on the battery status.</span>
<span class="sd">		</span>
<span class="sd">		Args:</span>
<span class="sd">			self: current class instance.</span>
<span class="sd">			msg: refers to the object that is set up to receive and process messages published to the topic /state/battery_low,</span>
<span class="sd">			in order to monitor the state of the robot&#39;s battery.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">mutex</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>    <span class="c1"># take the mutex</span>
		<span class="k">try</span><span class="p">:</span> 
			<span class="bp">self</span><span class="o">.</span><span class="n">battery_low</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">data</span>    <span class="c1"># change the flag of battery low with the received message</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">battery_low</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
				<span class="n">log_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">@@@### BATTERY: LOW! RECHARGE! ###@@@</span><span class="se">\n</span><span class="s1">&#39;</span>
				<span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">tag_log</span><span class="p">(</span><span class="n">log_msg</span><span class="p">,</span> <span class="n">LOG_TAG</span><span class="p">))</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">battery_low</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
				<span class="n">log_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">@@@### BATTERY: FULL ###@@@</span><span class="se">\n</span><span class="s1">&#39;</span>
				<span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">tag_log</span><span class="p">(</span><span class="n">log_msg</span><span class="p">,</span> <span class="n">LOG_TAG</span><span class="p">))</span>
		<span class="k">finally</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">mutex</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>    <span class="c1"># release the mutex</span></div>
	
			
<div class="viewcode-block" id="Helper.ret_battery_low"><a class="viewcode-back" href="../../../index.html#utilities.assignment2.fsm_helper.Helper.ret_battery_low">[docs]</a>	<span class="k">def</span> <span class="nf">ret_battery_low</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">		This function retrieves the value of a variable that indicates whether the robot&#39;s battery level is low or not.</span>
<span class="sd">		The returned value will be &quot;True&quot; if the battery level is low, and &quot;False&quot; otherwise.</span>
<span class="sd">		</span>
<span class="sd">		Args:</span>
<span class="sd">			self: current class instance.</span>
<span class="sd">		</span>
<span class="sd">		Returns:</span>
<span class="sd">			self.battery_low: a boolean value indicating the current status of the battery.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">battery_low</span></div>
			
			
<div class="viewcode-block" id="Helper.recharge_srv"><a class="viewcode-back" href="../../../index.html#utilities.assignment2.fsm_helper.Helper.recharge_srv">[docs]</a>	<span class="k">def</span> <span class="nf">recharge_srv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">		This is a service used to recharge the robot&#39;s battery. When the battery is low and the robot</span>
<span class="sd">		is at the charging location, a request is sent to the service to start charging the battery.</span>
<span class="sd">		After a specified time, the service returns a result indicating that the battery is fully charged.</span>
<span class="sd">		Once the service has finished, the variable battery_low is set to &quot;False&quot; to indicate that the robot&#39;s</span>
<span class="sd">		battery is now high. The service is blocking, meaning that the program execution is paused until</span>
<span class="sd">		the service returns a result.</span>
<span class="sd">		</span>
<span class="sd">		Args:</span>
<span class="sd">			self: current class instance.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">request</span> <span class="o">=</span> <span class="n">SetBoolRequest</span><span class="p">()</span>
		<span class="n">request</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recharge_cli</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
		<span class="n">log_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">The Robot has been recharged! Ready for action!!</span><span class="se">\n\n</span><span class="s1">&#39;</span>
		<span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">tag_log</span><span class="p">(</span><span class="n">log_msg</span><span class="p">,</span> <span class="n">LOG_TAG</span><span class="p">))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">battery_low</span> <span class="o">=</span> <span class="kc">False</span></div>
	
		
<div class="viewcode-block" id="Helper.go_to_goal"><a class="viewcode-back" href="../../../index.html#utilities.assignment2.fsm_helper.Helper.go_to_goal">[docs]</a>	<span class="k">def</span> <span class="nf">go_to_goal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">		This function sets a goal in space based on the decision made by the Reasoner. The coordinates of the goal are</span>
<span class="sd">		retrieved and passed to the MoveBase action service, which uses a SLAM algorithm to find a path between the</span>
<span class="sd">		robot and the goal, taking into account the environment and obstacles. The robot follows this path and can</span>
<span class="sd">		adjust it in real-time if new obstacles are detected by sensors. MoveBase also ensures that the robot stays on the desired path.</span>
<span class="sd">		</span>
<span class="sd">		Args:</span>
<span class="sd">			self: current class instance.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># Reset the boolean variables</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">reset_var</span><span class="p">()</span>
		<span class="c1"># Get the goal and its coordinates</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">room_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rooms</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_next_goal</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="n">log_msg</span> <span class="o">=</span> <span class="n">Fore</span><span class="o">.</span><span class="n">RED</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;Goal cannot be found!</span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">tag_log</span><span class="p">(</span><span class="n">log_msg</span><span class="p">,</span> <span class="n">LOG_TAG</span><span class="p">))</span>
			<span class="c1"># Reset console color to default</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[39m&#39;</span><span class="p">)</span> 
		<span class="n">log_msg</span> <span class="o">=</span> <span class="n">Fore</span><span class="o">.</span><span class="n">CYAN</span><span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">The robot is planning to go to:</span><span class="se">\n</span><span class="s1">Room: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_rooms</span><span class="p">[</span><span class="n">room_index</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s1">Coordinates: (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_rooms_coord</span><span class="p">[</span><span class="n">room_index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">,</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_rooms_coord</span><span class="p">[</span><span class="n">room_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">)</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">tag_log</span><span class="p">(</span><span class="n">log_msg</span><span class="p">,</span> <span class="n">LOG_TAG</span><span class="p">))</span>
		<span class="c1"># Reset console color to default</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[39m&#39;</span><span class="p">)</span> 
		<span class="n">goal</span> <span class="o">=</span> <span class="n">MoveBaseGoal</span><span class="p">()</span>
		<span class="c1"># Set the desired goal that we want to reach</span>
		<span class="n">goal</span><span class="o">.</span><span class="n">target_pose</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="s2">&quot;map&quot;</span>
		<span class="n">goal</span><span class="o">.</span><span class="n">target_pose</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
		<span class="n">goal</span><span class="o">.</span><span class="n">target_pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rooms_coord</span><span class="p">[</span><span class="n">room_index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">goal</span><span class="o">.</span><span class="n">target_pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rooms_coord</span><span class="p">[</span><span class="n">room_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">goal</span><span class="o">.</span><span class="n">target_pose</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">orientation</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="c1"># Sends the goal to the action server.</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">move_cli</span><span class="o">.</span><span class="n">send_goal</span><span class="p">(</span><span class="n">goal</span><span class="p">)</span></div>
		
	
<div class="viewcode-block" id="Helper.check_motion"><a class="viewcode-back" href="../../../index.html#utilities.assignment2.fsm_helper.Helper.check_motion">[docs]</a>	<span class="k">def</span> <span class="nf">check_motion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">		This method verifies if the robot has successfully reached its goal by checking if the state of the</span>
<span class="sd">		MoveBase action service is equal to &quot;DONE&quot;. Once the robot has reached its goal, the ontology is updated.</span>
<span class="sd">		This involves placing the robot in its new location in the ontology, as well as updating the timestamps</span>
<span class="sd">		of the robot and goal location to ensure proper behavior.</span>
<span class="sd">		</span>
<span class="sd">		Args:</span>
<span class="sd">			self: current class instance.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># Execute only when the plan action service is done</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_cli</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span> <span class="o">==</span> <span class="n">DONE</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">battery_low</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
			<span class="n">log_msg</span> <span class="o">=</span> <span class="n">Fore</span><span class="o">.</span><span class="n">GREEN</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">The robot reached final goal!&#39;</span>
			<span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">tag_log</span><span class="p">(</span><span class="n">log_msg</span><span class="p">,</span> <span class="n">LOG_TAG</span><span class="p">))</span>
			<span class="c1"># Reset console color to default</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[39m&#39;</span><span class="p">)</span> 
			<span class="c1"># Update the position of the ROBOT in the ontology</span>
			<span class="n">ARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;isIn&#39;</span><span class="p">,</span> <span class="s1">&#39;Robot1&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_goal</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prev_goal</span><span class="p">]</span>
			<span class="n">ontology_manager</span><span class="p">(</span><span class="s1">&#39;REPLACE&#39;</span><span class="p">,</span> <span class="s1">&#39;OBJECTPROP&#39;</span><span class="p">,</span> <span class="s1">&#39;IND&#39;</span> <span class="p">,</span> <span class="n">ARGS</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_prev_goal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_goal</span>
			<span class="c1"># Reason about the onoloy</span>
			<span class="n">ARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
			<span class="n">ontology_manager</span><span class="p">(</span><span class="s1">&#39;REASON&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ARGS</span><span class="p">)</span>
			<span class="c1"># Retreive the last time the robot moved</span>
			<span class="n">ARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;now&#39;</span><span class="p">,</span> <span class="s1">&#39;Robot1&#39;</span><span class="p">]</span>
			<span class="n">last_motion</span> <span class="o">=</span> <span class="n">ontology_manager</span><span class="p">(</span><span class="s1">&#39;QUERY&#39;</span><span class="p">,</span> <span class="s1">&#39;DATAPROP&#39;</span><span class="p">,</span> <span class="s1">&#39;IND&#39;</span><span class="p">,</span> <span class="n">ARGS</span><span class="p">)</span>
			<span class="n">last_motion</span> <span class="o">=</span> <span class="n">ontology_format</span><span class="p">(</span><span class="n">last_motion</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
			<span class="c1"># Retreive the last time a specific location has been visited</span>
			<span class="n">ARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;visitedAt&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_goal</span><span class="p">]</span>
			<span class="n">last_location</span> <span class="o">=</span> <span class="n">ontology_manager</span><span class="p">(</span><span class="s1">&#39;QUERY&#39;</span><span class="p">,</span> <span class="s1">&#39;DATAPROP&#39;</span><span class="p">,</span> <span class="s1">&#39;IND&#39;</span><span class="p">,</span> <span class="n">ARGS</span><span class="p">)</span>
			<span class="n">last_location</span> <span class="o">=</span> <span class="n">ontology_format</span><span class="p">(</span><span class="n">last_location</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span> 
			<span class="c1"># Update the time</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">timer_now</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span> 
			<span class="c1"># Update the timestamp since the robot moved</span>
			<span class="n">ARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;now&#39;</span><span class="p">,</span> <span class="s1">&#39;Robot1&#39;</span><span class="p">,</span> <span class="s1">&#39;Long&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer_now</span><span class="p">,</span> <span class="n">last_motion</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
			<span class="n">ontology_manager</span><span class="p">(</span><span class="s1">&#39;REPLACE&#39;</span><span class="p">,</span> <span class="s1">&#39;DATAPROP&#39;</span><span class="p">,</span> <span class="s1">&#39;IND&#39;</span><span class="p">,</span> <span class="n">ARGS</span><span class="p">)</span>
			<span class="c1"># Update the timestamp since the robot visited the location</span>
			<span class="n">ARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;visitedAt&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_goal</span><span class="p">,</span> <span class="s1">&#39;Long&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer_now</span><span class="p">,</span> <span class="n">last_location</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
			<span class="n">ontology_manager</span><span class="p">(</span><span class="s1">&#39;REPLACE&#39;</span><span class="p">,</span> <span class="s1">&#39;DATAPROP&#39;</span><span class="p">,</span> <span class="s1">&#39;IND&#39;</span><span class="p">,</span> <span class="n">ARGS</span><span class="p">)</span>
			<span class="c1"># Cancel the goal to be sure</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">cancel_motion</span><span class="p">()</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">motion_completed</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Set to True only the one involved in the state</span></div>
	
		
<div class="viewcode-block" id="Helper.motion_done"><a class="viewcode-back" href="../../../index.html#utilities.assignment2.fsm_helper.Helper.motion_done">[docs]</a>	<span class="k">def</span> <span class="nf">motion_done</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">		Retrieve the value of the variable that indicates whether the robot has reached its destination or not.</span>
<span class="sd">		The output value will be &quot;True&quot; if the robot has successfully reached the goal, and &quot;False&quot; if it hasn&#39;t reached it yet.</span>
<span class="sd">		</span>
<span class="sd">		Args:</span>
<span class="sd">			self: current class instance.</span>
<span class="sd">		</span>
<span class="sd">		Returns:</span>
<span class="sd">			self.motion_completed: refers to a boolean variable that indicates the status of the robot&#39;s movement.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">motion_completed</span></div>
		
	
<div class="viewcode-block" id="Helper.cancel_motion"><a class="viewcode-back" href="../../../index.html#utilities.assignment2.fsm_helper.Helper.cancel_motion">[docs]</a>	<span class="k">def</span> <span class="nf">cancel_motion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">		This function stops any current goals that have been sent to the MoveBase action service.</span>
<span class="sd">		</span>
<span class="sd">		Args:</span>
<span class="sd">			self: current class instance.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">log_msg</span> <span class="o">=</span> <span class="n">Fore</span><span class="o">.</span><span class="n">RED</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;Cancel goal</span><span class="se">\n\n</span><span class="s1">&#39;</span>
		<span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">tag_log</span><span class="p">(</span><span class="n">log_msg</span><span class="p">,</span> <span class="n">LOG_TAG</span><span class="p">))</span>
		<span class="c1"># Reset console color to default</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[39m&#39;</span><span class="p">)</span> 
		<span class="c1"># Cancel the goal</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">move_cli</span><span class="o">.</span><span class="n">cancel_all_goals</span><span class="p">()</span>
		<span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>
				
				
<div class="viewcode-block" id="Helper.reset_var"><a class="viewcode-back" href="../../../index.html#utilities.assignment2.fsm_helper.Helper.reset_var">[docs]</a>	<span class="k">def</span> <span class="nf">reset_var</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">		This function resets all the variables used to determine when a task has completed its execution.</span>
<span class="sd">		</span>
<span class="sd">		Args:</span>
<span class="sd">			self: current class instance.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">mutex</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>    <span class="c1"># take the mutex</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">reasoner_done</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">motion_completed</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">charge_reached</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">check_completed</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">mutex</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>    <span class="c1"># release the mutex</span></div>
		
	
	<span class="k">def</span> <span class="nf">do_surveillance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c1"># Reset the boolean variables</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">reset_var</span><span class="p">()</span>
		<span class="c1"># Surveillance task</span>
		<span class="n">log_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">The robot starts surveilling room: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_next_goal</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">tag_log</span><span class="p">(</span><span class="n">log_msg</span><span class="p">,</span> <span class="n">LOG_TAG</span><span class="p">))</span>
		<span class="n">joint_angle</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">battery_low</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">joint_angle</span> <span class="o">&lt;=</span> <span class="mf">3.1</span><span class="p">:</span> <span class="c1"># If bettery low there won&#39;t be surveillance task</span>
			<span class="c1"># Rotate the base joint of the robot</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">pub_base_joint</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">joint_angle</span><span class="p">)</span>
			<span class="n">joint_angle</span> <span class="o">+=</span> <span class="mf">0.1</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">rate</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>
		<span class="c1"># Make the camera look the fron side of the robot</span>
		<span class="n">joint_angle</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pub_base_joint</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">joint_angle</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">battery_low</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
			<span class="n">log_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">The robot checked location: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_next_goal</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">&#39;</span>
			<span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">tag_log</span><span class="p">(</span><span class="n">log_msg</span><span class="p">,</span> <span class="n">LOG_TAG</span><span class="p">))</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">check_completed</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Set to True only the one involved in the state</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">log_msg</span> <span class="o">=</span> <span class="n">Fore</span><span class="o">.</span><span class="n">RED</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Stop surveilling! Battery low!</span><span class="se">\n\n</span><span class="s1">&#39;</span>
			<span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="n">anm</span><span class="o">.</span><span class="n">tag_log</span><span class="p">(</span><span class="n">log_msg</span><span class="p">,</span> <span class="n">LOG_TAG</span><span class="p">))</span>
			<span class="c1"># Reset console color to default</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[39m&#39;</span><span class="p">)</span> 
			<span class="bp">self</span><span class="o">.</span><span class="n">check_completed</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Set to False since action was not completed</span>
	
<div class="viewcode-block" id="Helper.surveillance_done"><a class="viewcode-back" href="../../../index.html#utilities.assignment2.fsm_helper.Helper.surveillance_done">[docs]</a>	<span class="k">def</span> <span class="nf">surveillance_done</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		This function indicates that surveillance is done.</span>

<span class="sd">		Returns:</span>
<span class="sd">			self.check_completed: refers to a boolean variable that indicates the surveillance is completed.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_completed</span></div></div>
		
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">assignment2</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, Jabrail Chumakov.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
    </div>

    

    
  </body>
</html>